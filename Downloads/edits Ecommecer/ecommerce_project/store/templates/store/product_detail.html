{% extends 'store/base.html' %}

{% block content %}
<h2>{{ product.name }}</h2>
<p>{{ product.description }}</p>
<p>Price: ${{ product.price }}</p>
<p>Store: {{ product.store.name }}</p>
<p>Available: {{ product.inventory }}</p>

{% if user.is_authenticated and purchased %}
    {% if product.inventory > 0 %}
    <form method="post" action="{% url 'add_to_cart' product.id %}" class="d-inline">
        {% csrf_token %}
        <label class="form-label me-2">Quantity</label>
        <input type="number" name="quantity" value="1" min="1" max="{{ product.inventory }}" class="form-control d-inline-block" style="width:100px">
        <button type="submit" class="btn btn-success ms-2">Add to Cart</button>
    </form>
    {% else %}
    <button class="btn btn-secondary" disabled>Out of Stock</button>
    {% endif %}
    <a href="{% url 'add_review' product.id %}" class="btn btn-primary ms-2">Leave a Review</a>
{% elif user.is_authenticated %}
    {% if product.inventory > 0 %}
    <form method="post" action="{% url 'add_to_cart' product.id %}" class="d-inline">
        {% csrf_token %}
        <label class="form-label me-2">Quantity</label>
        <input type="number" name="quantity" value="1" min="1" max="{{ product.inventory }}" class="form-control d-inline-block" style="width:100px">
        <button type="submit" class="btn btn-success ms-2">Add to Cart</button>
    </form>
    {% else %}
    <button class="btn btn-secondary" disabled>Out of Stock</button>
    {% endif %}
{% else %}
    <a href="{% url 'login' %}" class="btn btn-outline-primary">Login to purchase</a>
{% endif %}

<hr>
<h3>Reviews</h3>
{% for review in reviews %}
    <div class="card mb-2">
        <div class="card-body">
            <h5 class="card-title">
                {{ review.user.username }} - Rating: {{ review.rating }}/5
                <span class="badge bg-success">Verified Purchase</span>
            </h5>
            <p class="card-text">{{ review.comment }}</p>
        </div>
    </div>
{% empty %}
    <p>No reviews yet.</p>
{% endfor %}
{% endblock %}
